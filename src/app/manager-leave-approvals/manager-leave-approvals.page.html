<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button (click)="goBack()" defaultHref="/my-team"></ion-back-button>
        </ion-buttons>
        <ion-title>Leave Approvals</ion-title>
        <!-- <ion-buttons slot="end">
            <ion-button (click)="loadPendingLeaves()">
                <ion-icon name="refresh" slot="icon-only"></ion-icon>
            </ion-button>
        </ion-buttons> -->
    </ion-toolbar>

    <!-- Search and Filters -->
    <ion-toolbar>
        <ion-searchbar placeholder="Search employee..." (ionInput)="onSearchChange($event)" [debounce]="300">
        </ion-searchbar>
    </ion-toolbar>

    <ion-toolbar>
        <ion-item lines="none">
            <div class="select-tag row-right">
                <ion-label>Leave Type:</ion-label>
                <div>
                    <ion-select [(ngModel)]="leaveTypeFilter" (ionChange)="onTypeFilterChange($event)"
                    interface="popover" toggleIcon="chevron-down" expandedIcon="chevron-up">
                        <ion-select-option value="all">Select Leaves</ion-select-option>
                        <ion-select-option *ngFor="let type of leaveTypes" [value]="type.type_code">
                            {{ type.type_name }}
                        </ion-select-option>
                    </ion-select>
                </div>

            </div>

        </ion-item>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Loading pending leave requests...</p>
    </div>

    <!-- Empty State -->
    <ion-row class="no-leaves" *ngIf="!isLoading && filteredLeaves.length === 0" >
        <ion-col size="12" class="ion-text-center">
          <img src="../../../../assets/no_leavedata_img.svg">
          <p class="no-data-text">No Pending Leaves.</p>
        </ion-col>
      </ion-row>
  

    <!-- Leave Cards -->
    <div class="requests-container" *ngIf="!isLoading && filteredLeaves.length > 0">
        <ion-card *ngFor="let leave of filteredLeaves" class="wfh-card">
                <ion-card-header>
                        <div class="card-header-content row-space-between">
                            <div class="row-left">
                                <ion-avatar class="employee-avatar mr-8">
                        <img [src]="getProfileImage(leave)" />
                    </ion-avatar>
                    <div class="employee-info">
                        <ion-card-title>{{ leave.FirstName }} {{ leave.LastName }}</ion-card-title>
                    <p class="employee-number">{{ leave.EmployeeNumber }}</p>
                        </div>
                </div>     
                   
                    <ion-badge [ngClass]="getStatusColor(leave.status)">
                        {{ leave.status || 'pending' }}
                    </ion-badge>
                </div>
            </ion-card-header>

            <ion-card-content>
                <!-- Leave Type -->
                <div class="row-space-between">
                    <div>
                        <label>Leave Type:</label>
                        <p>{{ leave.type_name }} ({{ leave.type_code }})</p>
                    </div>
                    <div>
                        <label>Start Date - End Date</label>
                        <p>{{ leave.start_date | date:'mediumDate' }} - {{ leave.end_date | date:'mediumDate' }}</p>
                    </div>
                    <div>
                        <label>Duration:</label>
                        <p class="total-days">{{ leave.total_days }} day(s)</p>
                    </div>
                    <div>
                            <label>Applied On:</label>
                            <p>{{ leave.applied_at | date }}</p>
                        </div>
                </div>

         

                <!-- Available Balance -->
                <!-- <div class="info-row" *ngIf="leave.available_balance !== undefined">
                    <ion-icon name="wallet-outline"></ion-icon>
                    <div>
                        <strong>Available Balance:</strong>
                        <p [class.low-balance]="leave.available_balance < leave.total_days">
                            {{ leave.available_balance }} days
                        </p>
                    </div>
                </div> -->

                <!-- Reason -->
                <div class="info-row" *ngIf="leave.reason">
                        <label>Reason:</label>
                        <p>{{ leave.reason }}</p>
                </div>

       

                <!-- Action Buttons -->
                <div class="row-right">
                    <ion-button class="primary-outline-btn" (click)="rejectLeave(leave)">
                            Reject
                        </ion-button>
                    <ion-button class="primary-btn" (click)="approveLeave(leave)">
                        Approve
                    </ion-button>
              
                </div>
            </ion-card-content>
        </ion-card>
    </div>
</ion-content>